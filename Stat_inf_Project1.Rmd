---
title: "Analysis of the exponential distribution in R and comparing it with the Central Limit Theorem"
author: "Vadim K."
date: "2017-01-08"
output:
  html_document:
    keep_md: yes
  pdf_document: default
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview
This project is aimed to investigate the exponential distribution in R and compare it with the Central Limit Theorem. We make a simulation of 1000 averages of 40 exponentials and illustrate the properties of the obtained distribution (sample mean and variance are compared with theoretical ones).  
We also show that the obtained distribution is approximately normal which complies with Central Limit Theorem.

##Simulations
We take the rate parameter 'lambda' for the exponential distribution equal 0.2.
```{r}
lambda <- 0.2
```
Theoretical mean of exponential distribution is 1/lambda and the standard deviation is also 1/lambda.
```{r}
mu <- 1/lambda
sigma <- 1/lambda
```
Sample size is 40
```{r}
n <- 40
```
And the number of simulations is 1000
```{r}
nosim <- 1000
```
We generate a matrix called 'sample' of random exponentials with given parameters. 
```{r}
set.seed(11142)
sample <- matrix(rexp(nosim * n, rate = lambda), nosim, n)
```


##Sample Mean versus Theoretical Mean
From simulated data we generate a vector called 'sample_means' of 1000 averages of 40 exponentials
```{r}
sample_means <- apply(sample, 1, mean)
```
Now we can plot the histogram of sample distribution overlapping it with theoretical mean and observed mean of the sample averages (we'll use 'ggplot2' package in this project)
```{r echo = FALSE}
library(ggplot2)
g1 <- ggplot(data.frame(sample_means), aes(x = sample_means)) + 
      geom_histogram(binwidth = 0.5, color = "white", fill = "steelblue1") +
      labs(list(title = "Distribution of 1000 averages of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_vline(xintercept = mu, color = "red", size = 1.5) +
      geom_vline(xintercept = mean(sample_means), color = "blue", size = 1.5) +
      annotate("text", label = "Theoretical Mean", 
               fontface = "bold", color = "red", 
               x = 4.8, y = 100, size = 4, angle = 90) + 
      annotate("text", label = "Sample Mean", 
               fontface = "bold", color = "blue", 
               x = 5.2, y = 100, size = 4, angle = 90) +
      theme(plot.title = element_text(size=11))
```
```{r fig.width=4, fig.height=3}
print(g1)
```

As we can see the distribution of averages is centered close to the theoretical mean.  
Mean of the simulated averages is equal 5.067 which is very close to theoretical one:
```{r}
data.frame("Theretical Mean" = mu, "Sample.Mean" = mean(sample_means))
```
##Sample Variance versus Theoretical Variance
From simulated data we generate a vector called 'sample_vars' holding 1000 variances of 40 exponentials
```{r}
sample_vars <- apply(sample, 1, var)
```
Now we can plot the histogram of sample variances distribution overlapping it with theoretical variance and observed mean of the sample variances
```{r echo = FALSE}
g2 <- ggplot(data.frame(sample_vars), aes(x = sample_vars)) + 
      geom_histogram(binwidth = 5, color = "white", fill = "steelblue1") +
      labs(list(title = "Distribution of 1000 variances of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_vline(xintercept = sigma^2, color = "red", size = 1.5) +
      geom_vline(xintercept = mean(sample_vars), color = "blue", size = 1.5) +
      annotate("text", label = "Theoretical Variance", 
               fontface = "bold", color = "red", 
               x = 22, y = 100, size = 4, angle = 90) + 
      annotate("text", label = "Mean of sample variances", 
               fontface = "bold", color = "blue", 
               x = 28, y = 100, size = 4, angle = 90) +
      theme(plot.title = element_text(size=11))
```

```{r fig.width=4, fig.height=3}
print(g2)
```

As we can see the distribution of variances is centered close to the theoretical variance.    
Mean of the simulated variances is equal 25.84 which is very close to theoretical one:
```{r}
data.frame("Theretical Variance" = sigma^2, "Mean of Sample Var" = mean(sample_vars))
```

##Distribution
Now let's illustrate approximate normality of distribution of a large collection of averages of 40 exponentials.  
In order to do it we will plot again a histogram of 1000 averages together with its density function, overlapping with Normal distribution with mean and standard deviation equal those from sample data.
```{r echo = FALSE}
g3 <- ggplot(data.frame(sample_means), aes(x = sample_means)) + 
      geom_histogram(binwidth = 0.4, color = "white", fill = "steelblue1", aes(y = ..density..)) +
      labs(list(title = "Distribution of 1000 averages of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_density(size = 2, aes(color = "1")) + 
      stat_function(fun = dnorm, args = list(mean = mean(sample_means), 
                                             sd = sd(sample_means)), 
                    size = 2, aes(color = "2")) + 
      scale_color_manual(values = c("blue4", "red"),
                         labels = c("Density function",
                                    "Normal Distribution"),
                         name = "") +
      theme(plot.title = element_text(size=11))
```

```{r echo = FALSE}
rand_exp <- rexp(1000, lambda)

g4 <- ggplot(data.frame(rand_exp), aes(x = rand_exp)) + 
      geom_histogram(binwidth = 2.5, color = "white", fill = "steelblue1", aes(y = ..density..)) +
      labs(list(title = "Distribution of 1000 random exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_density(size = 2, aes(color = "1")) + 
      stat_function(fun = dnorm, args = list(mean = mean(rand_exp), 
                                             sd = sd(rand_exp)), 
                    size = 2, aes(color = "2")) + 
      scale_color_manual(values = c("blue4", "red"),
                         labels = c("Density function",
                                    "Normal Distribution"),
                         name = "") +
      theme(plot.title = element_text(size=11))
```

```{r fig.width=10, fig.height=3}
library(gridExtra)
grid.arrange(g3, g4, nrow = 1)
```
As we can see that's very close to normal, comparing to the distribution of a large collection of random exponentials.  
Thus, we can conclude that the distribution of the means of 40 exponentials behaves as predicted by **Central Limit Theorem**.

\pagebreak

#APPENDIX 1

Here the full code for the plots

```{r}
library(ggplot2)
g1 <- ggplot(data.frame(sample_means), aes(x = sample_means)) + 
      geom_histogram(binwidth = 0.5, color = "white", fill = "steelblue1") +
      labs(list(title = "Distribution of 1000 averages of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_vline(xintercept = mu, color = "red", size = 2) +
      geom_vline(xintercept = mean(sample_means), color = "blue", size = 2) +
      annotate("text", label = "Theoretical Mean", 
               fontface = "bold", color = "red", 
               x = 4.8, y = 100, size = 4, angle = 90) + 
      annotate("text", label = "Sample Mean", 
               fontface = "bold", color = "blue", 
               x = 5.2, y = 100, size = 4, angle = 90) +
      theme(plot.title = element_text(size=11))
```

```{r}
g2 <- ggplot(data.frame(sample_vars), aes(x = sample_vars)) + 
      geom_histogram(binwidth = 5, color = "white", fill = "steelblue1") +
      labs(list(title = "Distribution of 1000 variances of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_vline(xintercept = sigma^2, color = "red", size = 2) +
      geom_vline(xintercept = mean(sample_vars), color = "blue", size = 2) +
      annotate("text", label = "Theoretical Variance", 
               fontface = "bold", color = "red", 
               x = 22, y = 100, size = 4, angle = 90) + 
      annotate("text", label = "Mean of sample variances", 
               fontface = "bold", color = "blue", 
               x = 28, y = 100, size = 4, angle = 90) +
      theme(plot.title = element_text(size=11))
```

```{r}
g3 <- ggplot(data.frame(sample_means), aes(x = sample_means)) + 
      geom_histogram(binwidth = 0.4, color = "white", fill = "steelblue1", aes(y = ..density..)) +
      labs(list(title = "Distribution of 1000 averages of 40 exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_density(size = 2, aes(color = "1")) + 
      stat_function(fun = dnorm, args = list(mean = mean(sample_means), 
                                             sd = sd(sample_means)), 
                    size = 2, aes(color = "2")) + 
      scale_color_manual(values = c("blue4", "red"),
                         labels = c("Density function",
                                    "Normal Distribution"),
                         name = "") +
      theme(plot.title = element_text(size=11))
```

```{r}
rand_exp <- rexp(1000, lambda)

g4 <- ggplot(data.frame(rand_exp), aes(x = rand_exp)) + 
      geom_histogram(binwidth = 2.5, color = "white", fill = "steelblue1", aes(y = ..density..)) +
      labs(list(title = "Distribution of 1000 random exponentials", 
                x = element_blank(),
                y = element_blank())) +
      geom_density(size = 2, aes(color = "1")) + 
      stat_function(fun = dnorm, args = list(mean = mean(rand_exp), 
                                             sd = sd(rand_exp)), 
                    size = 2, aes(color = "2")) + 
      scale_color_manual(values = c("blue4", "red"),
                         labels = c("Density function",
                                    "Normal Distribution"),
                         name = "") +
      theme(plot.title = element_text(size=11))
```








